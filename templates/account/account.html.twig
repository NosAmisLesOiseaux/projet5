{% extends "base.html.twig" %}

{% block body %}
    <h1>Mon compte {{ account_type }}</h1>
    <section>
        <div>
            <h2>Observations partagées</h2>
            <table>
                <thead>
                <tr>
                    <th>Observation</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                {% for capture in captures %}
                    <tr>
                        <td>Observation {{ capture.id }}</td>
                        <td>{{ capture.createdDate|date('d/m/Y') }}</td>
                        <td>
                            {% if capture.status == 'published' or capture.status == 'validated' %}
                                Validée
                            {% elseif capture.status == 'waiting_for_validation' %}
                                En attente de validation
                            {% endif %}
                        </td>
                        <td>
                            {% if is_granted('ROLE_NATURALIST') %}
                                {% if capture.status == 'published' or capture.status == 'validated' %}
                                    <a href="{{ path('modify_capture', {id: capture.id}) }}">Modifier l'observation {{ capture.id }}</a>
                                {% elseif capture.status == 'waiting_for_validation' %}
                                    <a href="{{ path('validate_capture', {id: capture.id}) }}">Valider l'observation {{ capture.id }}</a>
                                {% endif %}
                            {% else %}
                                <a href="{{ path('delete_capture', {'id': capture.id}) }}">Supprimer l'observation</a>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

        <div>
            <ul>
                {% if nbCapturesPages > 1 %}
                    {% if previousPage > 1 %}
                        <p>
                            <a href="{{ path('user_account', {page: previousPage}) }}"> << </a>
                        </p>
                    {% endif %}
                    {% for i in 1..nbCapturesPages %}
                        <li {% if page == i %} class="active" {% endif %}>
                            <a href="{{ path('user_account', {page: i}) }}"> {{i}} </a>
                        </li>
                    {% endfor %}
                    <p>
                        {% if nextPage <= nbCapturesPages %}
                            <a href="{{ path('user_account', {page: nextPage}) }}"> >> </a>
                        {% endif %}
                    </p>
                {% endif %}
            </ul>
        </div>
    </section>

    {% if app.user.avatar == null %}
        <img src="{{ asset('default/avatar.svg') }}" alt="" height="150">
    {% else %}
        <img src="{{ asset('uploads/avatar/' ~ app.user.avatar.filename ) }}" alt="" height="150">
    {% endif %}
    <h2>{{ app.user.firstname }}</h2>
    <p>
        {{ app.user.biography }}
    </p>

    <a href="{{ path('change_avatar') }}">Change avatar</a>
    {% include "account/biography_form.html.twig" %}
    {% include "password/change_password.html.twig" %}
{% endblock %}